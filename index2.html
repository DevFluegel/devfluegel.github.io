<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OP-Standards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 10px;
            background: #f0f0f0;
            font-size: 16px;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
        }
        .login, .main-menu, .category-select, .subcategory-select, .operation-view {
            display: none;
        }
        .active {
            display: block;
        }
        input, button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            box-sizing: border-box;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .section {
            background: white;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .detail-item {
            margin: 5px 0;
        }
        .editable {
            border: 1px solid #ccc;
            padding: 5px;
        }
        .notes {
            margin-top: 10px;
        }
        .note {
            background: #f8f9fa;
            padding: 5px;
            margin: 5px 0;
            border-radius: 3px;
        }
        .completed {
            text-decoration: line-through;
            color: #888;
        }
        @media (max-width: 600px) {
            body {
                font-size: 14px;
            }
            .section {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login-Bereich -->
        <div class="login active" id="login">
            <h2>Login</h2>
            <input type="password" id="password" placeholder="Passwort eingeben">
            <button onclick="handleLogin()">Einloggen</button>
        </div>

        <!-- Hauptmenü -->
        <div class="main-menu" id="main-menu">
            <h2>Willkommen</h2>
            <button onclick="showCategory('operations')">Operationen</button>
            <button onclick="showCategory('devices')">Geräte</button>
            <button onclick="promptModeSwitch()">Modus wechseln (aktuell: <span id="mode-display">user</span>)</button>
        </div>

        <!-- Kategorieauswahl (Operationen/Geräte) -->
        <div class="category-select" id="category-select">
            <h2 id="category-title"></h2>
            <div id="category-list"></div>
            <button onclick="backToMenu()">Zurück</button>
        </div>

        <!-- Unterkategorieauswahl (laparoskopisch/schnitt) -->
        <div class="subcategory-select" id="subcategory-select">
            <h2 id="subcategory-title"></h2>
            <div id="subcategory-list"></div>
            <button onclick="backToCategory()">Zurück</button>
        </div>

        <!-- Operationen-Ansicht -->
        <div class="operation-view" id="operation-view">
            <h2 id="op-name"></h2>
            <div id="op-details"></div>
            <div class="notes">
                <h3>Notizen</h3>
                <div id="notes-list"></div>
                <input type="text" id="new-note" placeholder="Neue Notiz">
                <button onclick="addNote()">Hinzufügen</button>
            </div>
            <button onclick="backToSubcategory()">Zurück</button>
        </div>
    </div>

    <script>
        // Exemplarische Daten
        const data = {
            operations: {
                Urologie: {
                    laparoskopisch: [
                        {
                            _id: "op_001",
                            name: "Laparoskopische Prostatektomie",
                            details: {
                                Lagerung: ["Rückenlage"],
                                Geräte: ["Laparoskop"],
                                Besonderheiten: ["Minimalinvasiv"]
                            }
                        }
                    ],
                    schnitt: [
                        {
                            _id: "op_002",
                            name: "Offene Nephrektomie",
                            details: {
                                Lagerung: ["Seitenlage"],
                                Siebe: ["--"],
                                Abdeckung: ["Standard-OP-Set"],
                                Nahtmaterial: ["Vicryl 2-0", "PDS 3-0"],
                                Sonstiges: ["Wundhaken", "Bauchdeckenhalter"],
                                Geräte: ["Bipolares Koagulationsgerät"],
                                Flüssigkeiten: ["5.000 ml Ringer-Lösung"],
                                Verband: ["Steriler Verband"],
                                Besonderheiten: ["Blutstillung beachten"]
                            }
                        }
                    ]
                }
            },
            devices: {
                Urologie: [
                    {
                        _id: "dev_001",
                        name: "Bipolares Koagulationsgerät",
                        description: "Gerät zur Blutstillung"
                    }
                ]
            },
            notes: {
                "op_002": [
                    { _id: "note_1", content: "Gerät überprüfen", isCompleted: false },
                    { _id: "note_2", content: "Extra Nahtmaterial bereitstellen", isCompleted: true }
                ]
            }
        };

        // Zustandsvariablen
        let mode = 'user';
        let currentCategory = '';
        let currentSubcategory = '';
        const USER_PW = '1234';
        const EDITOR_PW = 'test1234';

        // Login-Handler
        function handleLogin() {
            const password = document.getElementById('password').value;
            if (password === USER_PW) {
                mode = 'user';
                showMainMenu();
            } else if (password === EDITOR_PW) {
                mode = 'editor';
                showMainMenu();
            } else {
                alert('Falsches Passwort');
            }
        }

        // Menü anzeigen
        function showMainMenu() {
            document.getElementById('login').classList.remove('active');
            document.getElementById('main-menu').classList.add('active');
            document.getElementById('category-select').classList.remove('active');
            document.getElementById('subcategory-select').classList.remove('active');
            document.getElementById('operation-view').classList.remove('active');
            document.getElementById('mode-display').textContent = mode;
        }

        // Kategorie anzeigen (Operationen/Geräte)
        function showCategory(category) {
            currentCategory = category;
            document.getElementById('main-menu').classList.remove('active');
            document.getElementById('category-select').classList.add('active');
            const title = document.getElementById('category-title');
            const list = document.getElementById('category-list');
            title.textContent = category === 'operations' ? 'Operationen' : 'Geräte';
            list.innerHTML = '';
            const specialties = Object.keys(data[category]);
            specialties.forEach(specialty => {
                const btn = document.createElement('button');
                btn.textContent = specialty;
                btn.onclick = () => showSubcategory(specialty);
                list.appendChild(btn);
            });
        }

        // Unterkategorie anzeigen (laparoskopisch/schnitt)
        function showSubcategory(specialty) {
            document.getElementById('category-select').classList.remove('active');
            document.getElementById('subcategory-select').classList.add('active');
            const title = document.getElementById('subcategory-title');
            const list = document.getElementById('subcategory-list');
            title.textContent = `${specialty} - Auswahl`;
            list.innerHTML = '';
            if (currentCategory === 'operations') {
                const subcategories = Object.keys(data.operations[specialty]);
                subcategories.forEach(sub => {
                    const btn = document.createElement('button');
                    btn.textContent = sub;
                    btn.onclick = () => showSubcategoryItems(specialty, sub);
                    list.appendChild(btn);
                });
            } else {
                showSubcategoryItems(specialty);
            }
        }

        // Einzelne OPs/Geräte anzeigen
        function showSubcategoryItems(specialty, subcategory) {
            currentSubcategory = subcategory;
            document.getElementById('subcategory-select').classList.remove('active');
            document.getElementById('operation-view').classList.add('active');
            const opName = document.getElementById('op-name');
            const opDetails = document.getElementById('op-details');
            const notesList = document.getElementById('notes-list');
            opDetails.innerHTML = '';
            notesList.innerHTML = '';

            if (currentCategory === 'operations') {
                const operations = data.operations[specialty][subcategory];
                const op = operations[0]; // Erste OP als Beispiel
                opName.textContent = op.name;
                renderDetails(op.details, op._id);
            } else {
                const device = data.devices[specialty][0]; // Erstes Gerät als Beispiel
                opName.textContent = device.name;
                renderDetails({ Beschreibung: [device.description] }, device._id);
            }
        }

        // Details rendern
        function renderDetails(details, id) {
            const opDetails = document.getElementById('op-details');
            const notesList = document.getElementById('notes-list');
            for (const [key, value] of Object.entries(details)) {
                const section = document.createElement('div');
                section.className = 'section';
                section.innerHTML = `<h3>${key}</h3>`;
                const itemsDiv = document.createElement('div');
                value.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'detail-item';
                    if (mode === 'editor') {
                        itemDiv.innerHTML = `<input class="editable" value="${item}" onchange="updateDetail('${id}', '${key}', this.value, ${index})">`;
                    } else {
                        itemDiv.textContent = item;
                    }
                    itemsDiv.appendChild(itemDiv);
                });
                section.appendChild(itemsDiv);
                opDetails.appendChild(section);
            }

            // Notizen rendern
            const notes = data.notes[id] || [];
            notes.forEach(note => {
                const noteDiv = document.createElement('div');
                noteDiv.className = `note ${note.isCompleted ? 'completed' : ''}`;
                noteDiv.innerHTML = `${note.content}`;
                if (mode === 'editor') {
                    noteDiv.innerHTML += ` 
                        <button onclick="toggleNote('${id}', '${note._id}')">${note.isCompleted ? 'Rückgängig' : 'Erledigt'}</button>
                        <button onclick="deleteNote('${id}', '${note._id}')">Löschen</button>`;
                }
                notesList.appendChild(noteDiv);
            });
        }

        // Moduswechsel mit Passwortabfrage
        function promptModeSwitch() {
            const newMode = mode === 'user' ? 'editor' : 'user';
            const password = prompt(`Passwort für ${newMode}-Modus:`);
            if ((newMode === 'user' && password === USER_PW) || (newMode === 'editor' && password === EDITOR_PW)) {
                mode = newMode;
                document.getElementById('mode-display').textContent = mode;
                if (document.getElementById('operation-view').classList.contains('active')) {
                    showSubcategoryItems(currentSubcategory ? currentSubcategory : Object.keys(data[currentCategory])[0], currentSubcategory);
                }
            } else {
                alert('Falsches Passwort');
            }
        }

        // Zurück-Navigation
        function backToMenu() { showMainMenu(); }
        function backToCategory() {
            document.getElementById('subcategory-select').classList.remove('active');
            document.getElementById('category-select').classList.add('active');
        }
        function backToSubcategory() {
            document.getElementById('operation-view').classList.remove('active');
            document.getElementById('subcategory-select').classList.add('active');
        }

        // Detail aktualisieren
        function updateDetail(id, key, newValue, index) {
            if (currentCategory === 'operations') {
                const op = data.operations[currentSubcategory ? currentSubcategory : Object.keys(data.operations)[0]][currentSubcategory][0];
                if (op._id === id) op.details[key][index] = newValue;
            } else {
                const device = data.devices[currentSubcategory ? currentSubcategory : Object.keys(data.devices)[0]][0];
                if (device._id === id) device.description = newValue;
            }
        }

        // Notiz hinzufügen
        function addNote() {
            const content = document.getElementById('new-note').value;
            if (content) {
                const opId = data.operations[currentSubcategory ? currentSubcategory : Object.keys(data.operations)[0]][currentSubcategory][0]._id;
                if (!data.notes[opId]) data.notes[opId] = [];
                data.notes[opId].push({ _id: `note_${Date.now()}`, content, isCompleted: false });
                document.getElementById('new-note').value = '';
                showSubcategoryItems(currentSubcategory ? currentSubcategory : Object.keys(data[currentCategory])[0], currentSubcategory);
            }
        }

        // Notiz umschalten (erledigt/nicht erledigt)
        function toggleNote(opId, noteId) {
            const note = data.notes[opId].find(n => n._id === noteId);
            note.isCompleted = !note.isCompleted;
            showSubcategoryItems(currentSubcategory ? currentSubcategory : Object.keys(data[currentCategory])[0], currentSubcategory);
        }

        // Notiz löschen
        function deleteNote(opId, noteId) {
            data.notes[opId] = data.notes[opId].filter(n => n._id !== noteId);
            showSubcategoryItems(currentSubcategory ? currentSubcategory : Object.keys(data[currentCategory])[0], currentSubcategory);
        }
    </script>
</body>
</html>